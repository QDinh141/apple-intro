<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>K·∫øt Qu·∫£ ·∫¢nh - Photo Booth</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0; 
      padding: 0;
    }
    body {
      font-family: sans-serif;
      background-color: #f9f9f9;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      margin: 20px 0;
      font-size: 1.5rem;
      text-align: center;
    }
    /* Khung d·ªçc hi·ªÉn th·ªã 4 ·∫£nh */
    .vertical-strip {
      position: relative; /* ƒë·ªÉ ch·ª©a sticker */
      background-color: #fff;
      width: 300px;
      padding: 20px;
      border: 4px solid #ff69b4; /* M√†u vi·ªÅn m·∫∑c ƒë·ªãnh */
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    /* 4 ·∫£nh x·∫øp d·ªçc */
    .vertical-strip img {
      width: 100%;
      height: auto;
      border-radius: 5px;
      object-fit: cover;
    }
    /* Footer text (th·ªùi gian + th∆∞∆°ng hi·ªáu) */
    .footer-text {
      font-size: 0.9rem;
      color: #555;
      margin-top: 10px;
      text-align: center;
    }
    /* Ch·ªçn m√†u vi·ªÅn */
    .color-palette {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    .color-swatch {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #fff;
      transition: transform 0.2s;
    }
    .color-swatch:hover {
      transform: scale(1.1);
    }

    /* Khu v·ª±c sticker: nhi·ªÅu icon + NO STICKER */
    .sticker-list {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    /* N√∫t sticker bo tr√≤n, m√†u gradient */
    .sticker-item {
      font-size: 1.5rem;
      padding: 10px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      background: linear-gradient(45deg, #ff4081, #ff80ab);
      color: #fff;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 3px 6px rgba(0,0,0,0.16);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
    }
    .sticker-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.16);
    }

    /* Sticker (emoji) ƒë∆∞·ª£c g·∫Øn v√†o .vertical-strip */
    .sticker-emoji {
      position: absolute;
      font-size: 1rem;    /* Gi·∫£m k√≠ch th∆∞·ªõc sticker */
      pointer-events: none; 
    }
    /* N√∫t t·∫£i ·∫£nh v·ªÅ (bo tr√≤n, m√†u gradient) */
    .download-btn {
      margin: 20px 0;
      padding: 12px 24px;
      font-size: 1rem;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      background: linear-gradient(45deg, #ff4081, #ff80ab);
      color: #fff;
      font-weight: 600;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 3px 6px rgba(0,0,0,0.16);
    }
    .download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.16);
    }
  </style>
</head>
<body>
  <h1>K·∫øt Qu·∫£ ·∫¢nh</h1>

  <!-- Ch·ªçn m√†u vi·ªÅn (palette) -->
  <div class="color-palette" id="colorPalette">
    <!-- Th√™m/b·ªõt m√†u tu·ª≥ √Ω -->
    <div class="color-swatch" data-color="#ff69b4" style="background-color: #ff69b4;"></div>
    <div class="color-swatch" data-color="#a2d5f2" style="background-color: #a2d5f2;"></div>
    <div class="color-swatch" data-color="#b2f2a1" style="background-color: #b2f2a1;"></div>
    <div class="color-swatch" data-color="#f2e8a1" style="background-color: #f2e8a1;"></div>
    <div class="color-swatch" data-color="#f2a1a1" style="background-color: #f2a1a1;"></div>
  </div>

  <!-- Khu v·ª±c sticker: nhi·ªÅu icon (th·ªè, l·∫•p l√°nh, ng√¥i sao, tr√°i tim) + NO STICKER -->
  <div class="sticker-list" id="stickerList">
    <div class="sticker-item" data-sticker="üê∞">üê∞</div>
    <div class="sticker-item" data-sticker="‚ú®">‚ú®</div>
    <div class="sticker-item" data-sticker="‚≠ê">‚≠ê</div>
    <div class="sticker-item" data-sticker="‚ù§Ô∏è">‚ù§Ô∏è</div>
    <!-- N√∫t NO STICKER -->
    <div class="sticker-item" data-sticker="NONE">üö´</div>
  </div>

  <!-- Khung d·ªçc ch·ª©a 4 ·∫£nh -->
  <div class="vertical-strip" id="photoStrip">
    <!-- 4 ·∫£nh s·∫Ω ƒë∆∞·ª£c ch√®n ·ªü ƒë√¢y -->
    <div class="footer-text" id="footerText"></div>
  </div>

  <!-- N√∫t t·∫£i ·∫£nh (s·∫Ω ch·ª•p m√†n h√¨nh .vertical-strip) -->
  <button class="download-btn" id="downloadBtn">T·∫£i ·∫¢nh V·ªÅ</button>

  <!-- Th∆∞ vi·ªán html2canvas (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    // L·∫•y 4 ·∫£nh t·ª´ localStorage
    const photos = JSON.parse(localStorage.getItem('capturedPhotos')) || [];

    // DOM elements
    const photoStrip = document.getElementById('photoStrip');
    const footerText = document.getElementById('footerText');
    const colorPalette = document.getElementById('colorPalette');
    const stickerList = document.getElementById('stickerList');
    const downloadBtn = document.getElementById('downloadBtn');

    // Hi·ªÉn th·ªã 4 ·∫£nh x·∫øp d·ªçc
    photos.forEach(src => {
      const img = document.createElement('img');
      img.src = src;
      // Th√™m tr∆∞·ªõc footerText ƒë·ªÉ ·∫£nh n·∫±m tr√™n, text n·∫±m cu·ªëi
      photoStrip.insertBefore(img, footerText);
    });

    // Th√™m ng√†y gi·ªù + th∆∞∆°ng hi·ªáu
    const now = new Date();
    function formatDate(date) {
      const dd = String(date.getDate()).padStart(2, '0');
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const yyyy = date.getFullYear();
      let hours = date.getHours();
      let ampm = 'AM';
      if (hours >= 12) {
        ampm = 'PM';
      }
      hours = hours % 12 || 12;
      const hh = String(hours).padStart(2, '0');
      const min = String(date.getMinutes()).padStart(2, '0');
      return `${mm}/${dd}/${yyyy}  ${hh}:${min} ${ampm}`;
    }
    const dateStr = formatDate(now);
    footerText.textContent = `  ${dateStr}  ¬© ${now.getFullYear()} AW`;

    // 1) ƒê·ªïi m√†u vi·ªÅn khi click v√†o "ch·∫•m m√†u"
    colorPalette.addEventListener('click', (e) => {
      if (e.target.classList.contains('color-swatch')) {
        const color = e.target.getAttribute('data-color');
        photoStrip.style.borderColor = color;
      }
    });

    // 2) Sticker ch·ªâ xung quanh ·∫£nh, k√≠ch th∆∞·ªõc nh·ªè
    //    Thay v√¨ r·∫£i kh·∫Øp ·∫£nh, ta r·∫£i ·ªü 4 c·∫°nh: top, bottom, left, right.
    //    Ho·∫∑c r·∫£i 8 sticker xung quanh (random edge).
    function clearOldStickers() {
      const oldStickers = document.querySelectorAll('.sticker-emoji');
      oldStickers.forEach(st => st.remove());
    }

    function addStickers(emoji) {
      // Xo√° sticker c≈©
      clearOldStickers();
      // T√¨m t·∫•t c·∫£ <img> (4 ·∫£nh)
      const images = photoStrip.querySelectorAll('img');
      images.forEach(img => {
        placeStickersAroundEdges(emoji, photoStrip, img, 8);
      });
    }

    // H√†m r·∫£i 'stickerCount' sticker quanh c√°c c·∫°nh (top/bottom/left/right)
    // => sticker s·∫Ω ch·ªâ xu·∫•t hi·ªán quanh vi·ªÅn ·∫£nh, k√≠ch th∆∞·ªõc nh·ªè (font-size:1rem)
    function placeStickersAroundEdges(emoji, container, image, stickerCount=8) {
      const containerRect = container.getBoundingClientRect();
      const rect = image.getBoundingClientRect();

      // T·ªça ƒë·ªô ·∫£nh so v·ªõi container
      const offsetLeft = rect.left - containerRect.left;
      const offsetTop  = rect.top  - containerRect.top;
      const imgWidth   = rect.width;
      const imgHeight  = rect.height;

      for (let i = 0; i < stickerCount; i++) {
        const sticker = document.createElement('div');
        sticker.className = 'sticker-emoji';
        sticker.textContent = emoji;

        // Ch·ªçn ng·∫´u nhi√™n 1 trong 4 c·∫°nh: 0=top,1=right,2=bottom,3=left
        const edge = Math.floor(Math.random() * 4);
        // T√≠nh v·ªã tr√≠ x,y
        let x, y;
        switch(edge) {
          case 0: // top
            x = offsetLeft + Math.random() * imgWidth;
            y = offsetTop - 10; // L√™n tr√™n 1 ch√∫t
            break;
          case 1: // right
            x = offsetLeft + imgWidth + 10; // D·ªãch sang ph·∫£i
            y = offsetTop + Math.random() * imgHeight;
            break;
          case 2: // bottom
            x = offsetLeft + Math.random() * imgWidth;
            y = offsetTop + imgHeight + 10; 
            break;
          case 3: // left
            x = offsetLeft - 10;
            y = offsetTop + Math.random() * imgHeight;
            break;
        }

        sticker.style.left = x + 'px';
        sticker.style.top  = y + 'px';
        container.appendChild(sticker);
      }
    }

    // Khi click sticker-item => th√™m sticker quanh vi·ªÅn, ho·∫∑c NO STICKER
    stickerList.addEventListener('click', (e) => {
      if (e.target.classList.contains('sticker-item')) {
        const emoji = e.target.getAttribute('data-sticker');
        if (emoji === 'NONE') {
          clearOldStickers();
        } else {
          addStickers(emoji);
        }
      }
    });

    // 3) N√∫t "T·∫£i ·∫¢nh V·ªÅ" (ch·ª•p .vertical-strip b·∫±ng html2canvas)
    downloadBtn.addEventListener('click', () => {
      html2canvas(photoStrip).then(canvas => {
        const link = document.createElement('a');
        link.download = 'photo-strip.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    });
  </script>
</body>
</html>
